From 0af65b7753731ddfb8629b0c25381b3d5c149812 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Marcus=20M=C3=BCller?= <mmueller@gnuradio.org>
Date: Sat, 16 Jan 2021 22:28:03 +0100
Subject: [PATCH 3/4] CMake: Remove unused compile/header checks
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Marcus MÃ¼ller <mmueller@gnuradio.org>
---
 gnuradio-runtime/ConfigChecks.cmake | 136 ++++++++++++----------------
 gr-blocks/lib/ConfigChecks.cmake    |  48 +---------
 2 files changed, 62 insertions(+), 122 deletions(-)

diff --git a/gnuradio-runtime/ConfigChecks.cmake b/gnuradio-runtime/ConfigChecks.cmake
index d7dfa26f8..d02150a39 100644
--- a/gnuradio-runtime/ConfigChecks.cmake
+++ b/gnuradio-runtime/ConfigChecks.cmake
@@ -1,8 +1,8 @@
-# Copyright 2010-2013 Free Software Foundation, Inc.
+#Copyright 2010 - 2013 Free Software Foundation, Inc.
 #
-# This file is part of GNU Radio
+#This file is part of GNU Radio
 #
-# SPDX-License-Identifier: GPL-3.0-or-later
+#SPDX-License-Identifier: GPL-3.0-or-later
 #
 
 ########################################################################
@@ -13,79 +13,48 @@ IF(MSVC) #add this directory for our provided headers
 LIST(APPEND CMAKE_REQUIRED_INCLUDES ${CMAKE_SOURCE_DIR}/msvc)
 ENDIF(MSVC)
 
-GR_CHECK_HDR_N_DEF(sys/time.h HAVE_SYS_TIME_H)
 GR_CHECK_HDR_N_DEF(sys/types.h HAVE_SYS_TYPES_H)
-GR_CHECK_HDR_N_DEF(sys/socket.h HAVE_SYS_SOCKET_H)
-GR_CHECK_HDR_N_DEF(io.h HAVE_IO_H)
 GR_CHECK_HDR_N_DEF(sys/mman.h HAVE_SYS_MMAN_H)
 GR_CHECK_HDR_N_DEF(sys/ipc.h HAVE_SYS_IPC_H)
 GR_CHECK_HDR_N_DEF(sys/shm.h HAVE_SYS_SHM_H)
 GR_CHECK_HDR_N_DEF(signal.h HAVE_SIGNAL_H)
-GR_CHECK_HDR_N_DEF(netinet/in.h HAVE_NETINET_IN_H)
-GR_CHECK_HDR_N_DEF(arpa/inet.h HAVE_ARPA_INET_H)
-GR_CHECK_HDR_N_DEF(unistd.h HAVE_UNISTD_H)
-GR_CHECK_HDR_N_DEF(malloc.h HAVE_MALLOC_H)
-
 
 ########################################################################
 CHECK_CXX_SOURCE_COMPILES("
-    #include <signal.h>
-    int main(){sigaction(0, 0, 0); return 0;}
+#include <signal.h>
+    int main(){
+    sigaction(0, 0, 0);
+    return 0;}
     " HAVE_SIGACTION
 )
 GR_ADD_COND_DEF(HAVE_SIGACTION)
 
 ########################################################################
 CHECK_CXX_SOURCE_COMPILES("
-    #include <unistd.h>
-    int main(){sysconf(0); return 0;}
+#include <unistd.h>
+    int main(){
+    sysconf(0);
+    return 0;}
     " HAVE_SYSCONF
 )
 GR_ADD_COND_DEF(HAVE_SYSCONF)
 
 CHECK_CXX_SOURCE_COMPILES("
-    #include <unistd.h>
-    int main(){getpagesize(); return 0;}
+#include <unistd.h>
+    int main(){
+    getpagesize();
+    return 0;}
     " HAVE_GETPAGESIZE
 )
 GR_ADD_COND_DEF(HAVE_GETPAGESIZE)
 
-
-########################################################################
-CHECK_CXX_SOURCE_COMPILES("
-    #include <Winbase.h>
-    int main(){Sleep(0); return 0;}
-    " HAVE_SSLEEP
-)
-GR_ADD_COND_DEF(HAVE_SSLEEP)
-
-########################################################################
-CHECK_CXX_SOURCE_COMPILES("
-    #include <stdlib.h>
-    int main(){posix_memalign(0, 0, 0); return 0;}
-    " HAVE_POSIX_MEMALIGN
-)
-GR_ADD_COND_DEF(HAVE_POSIX_MEMALIGN)
-
-CHECK_CXX_SOURCE_COMPILES("
-    #include <malloc.h>
-    int main(){valloc(0); return 0;}
-    " HAVE_VALLOC
-)
-GR_ADD_COND_DEF(HAVE_VALLOC)
-
-if(APPLE)
-    # Apple's malloc has been 16 byte aligned since at least 10.4
-    ADD_DEFINITIONS(-DALIGNED_MALLOC=16)
-else()
-    ADD_DEFINITIONS(-DALIGNED_MALLOC=0)
-endif()
-
 ########################################################################
 SET(CMAKE_REQUIRED_LIBRARIES -lpthread)
 CHECK_CXX_SOURCE_COMPILES("
-    #include <signal.h>
-    int main(){pthread_sigmask(0, 0, 0); return 0;}
+#include <signal.h>
+    int main(){
+    pthread_sigmask(0, 0, 0);
+    return 0;}
     " HAVE_PTHREAD_SIGMASK
 )
 GR_ADD_COND_DEF(HAVE_PTHREAD_SIGMASK)
@@ -93,19 +62,18 @@ SET(CMAKE_REQUIRED_LIBRARIES)
 
 ########################################################################
 CHECK_CXX_SOURCE_COMPILES("
-    #include <windows.h>
+#include <windows.h>
     int main(){
-        HANDLE handle;
-        int size;
-        LPCTSTR lpName;
-        handle = CreateFileMapping(
-                         INVALID_HANDLE_VALUE,    // use paging file
-                         NULL,                    // default security
-                         PAGE_READWRITE,          // read/write access
-                         0,                       // max. object size
-                         size,                    // buffer size
-                         lpName);                 // name of mapping object
-        return 0;
+    HANDLE handle;
+    int size;
+    LPCTSTR lpName;
+    handle = CreateFileMapping(INVALID_HANDLE_VALUE, // use paging file
+                               NULL,                 // default security
+                               PAGE_READWRITE,       // read/write access
+                               0,                    // max. object size
+                               size,                 // buffer size
+                               lpName);              // name of mapping object
+    return 0;
     } " HAVE_CREATEFILEMAPPING
 )
 GR_ADD_COND_DEF(HAVE_CREATEFILEMAPPING)
@@ -113,9 +81,11 @@ GR_ADD_COND_DEF(HAVE_CREATEFILEMAPPING)
 ########################################################################
 SET(CMAKE_REQUIRED_LIBRARIES -lrt)
 CHECK_CXX_SOURCE_COMPILES("
-    #include <sys/types.h>
-    #include <sys/mman.h>
-    int main(){shm_open(0, 0, 0); return 0;}
+#include <sys/mman.h>
+#include <sys/types.h>
+    int main(){
+    shm_open(0, 0, 0);
+    return 0;}
     " HAVE_SHM_OPEN
 )
 GR_ADD_COND_DEF(HAVE_SHM_OPEN)
@@ -123,39 +93,51 @@ SET(CMAKE_REQUIRED_LIBRARIES)
 
 ########################################################################
 CHECK_CXX_SOURCE_COMPILES("
-    #define _GNU_SOURCE
-    #include <math.h>
-    int main(){double x, sin, cos; sincos(x, &sin, &cos); return 0;}
+#define _GNU_SOURCE
+#include <math.h>
+    int main(){
+    double x, sin, cos;
+    sincos(x, &sin, &cos);
+    return 0;}
     " HAVE_SINCOS
 )
 GR_ADD_COND_DEF(HAVE_SINCOS)
 
 CHECK_CXX_SOURCE_COMPILES("
-    #define _GNU_SOURCE
-    #include <math.h>
-    int main(){float x, sin, cos; sincosf(x, &sin, &cos); return 0;}
+#define _GNU_SOURCE
+#include <math.h>
+    int main(){
+    float x, sin, cos;
+    sincosf(x, &sin, &cos);
+    return 0;}
     " HAVE_SINCOSF
 )
 GR_ADD_COND_DEF(HAVE_SINCOSF)
 
 CHECK_CXX_SOURCE_COMPILES("
-    #include <math.h>
-    int main(){sinf(0); return 0;}
+#include <math.h>
+    int main(){
+    sinf(0);
+    return 0;}
     " HAVE_SINF
 )
 GR_ADD_COND_DEF(HAVE_SINF)
 
 CHECK_CXX_SOURCE_COMPILES("
-    #include <math.h>
-    int main(){cosf(0); return 0;}
+#include <math.h>
+    int main(){
+    cosf(0);
+    return 0;}
     " HAVE_COSF
 )
 GR_ADD_COND_DEF(HAVE_COSF)
 
 ########################################################################
 CHECK_CXX_SOURCE_COMPILES("
-    #include <sys/mman.h>
-    int main(){mmap(0, 0, 0, 0, 0, 0); return 0;}
+#include <sys/mman.h>
+    int main(){
+    mmap(0, 0, 0, 0, 0, 0);
+    return 0;}
     " HAVE_MMAP
 )
 GR_ADD_COND_DEF(HAVE_MMAP)
diff --git a/gr-blocks/lib/ConfigChecks.cmake b/gr-blocks/lib/ConfigChecks.cmake
index 2d3e1c8ce..2b7078fe1 100644
--- a/gr-blocks/lib/ConfigChecks.cmake
+++ b/gr-blocks/lib/ConfigChecks.cmake
@@ -1,8 +1,8 @@
-# Copyright 2012 Free Software Foundation, Inc.
+#Copyright 2012 Free Software Foundation, Inc.
 #
-# This file is part of GNU Radio
+#This file is part of GNU Radio
 #
-# SPDX-License-Identifier: GPL-3.0-or-later
+#SPDX-License-Identifier: GPL-3.0-or-later
 #
 
 ########################################################################
@@ -13,18 +13,7 @@ IF(MSVC) #add this directory for our provided headers
 LIST(APPEND CMAKE_REQUIRED_INCLUDES ${CMAKE_SOURCE_DIR}/msvc)
 ENDIF(MSVC)
 
-GR_CHECK_HDR_N_DEF(sys/time.h HAVE_SYS_TIME_H)
-GR_CHECK_HDR_N_DEF(sys/types.h HAVE_SYS_TYPES_H)
-GR_CHECK_HDR_N_DEF(sys/socket.h HAVE_SYS_SOCKET_H)
 GR_CHECK_HDR_N_DEF(io.h HAVE_IO_H)
-GR_CHECK_HDR_N_DEF(sys/mman.h HAVE_SYS_MMAN_H)
-GR_CHECK_HDR_N_DEF(sys/ipc.h HAVE_SYS_IPC_H)
-GR_CHECK_HDR_N_DEF(sys/shm.h HAVE_SYS_SHM_H)
-GR_CHECK_HDR_N_DEF(signal.h HAVE_SIGNAL_H)
-GR_CHECK_HDR_N_DEF(netinet/in.h HAVE_NETINET_IN_H)
-GR_CHECK_HDR_N_DEF(arpa/inet.h HAVE_ARPA_INET_H)
-GR_CHECK_HDR_N_DEF(unistd.h HAVE_UNISTD_H)
-GR_CHECK_HDR_N_DEF(malloc.h HAVE_MALLOC_H)
 
 ########################################################################
 CHECK_INCLUDE_FILE_CXX(windows.h HAVE_WINDOWS_H)
@@ -33,34 +22,3 @@ IF(HAVE_WINDOWS_H)
     MESSAGE(STATUS "Adding windows libs to gr blocks libs...")
     LIST(APPEND blocks_libs ws2_32 wsock32)
 ENDIF(HAVE_WINDOWS_H)
-
-########################################################################
-CHECK_CXX_SOURCE_COMPILES("
-    #define _GNU_SOURCE
-    #include <math.h>
-    int main(){double x, sin, cos; sincos(x, &sin, &cos); return 0;}
-    " HAVE_SINCOS
-)
-GR_ADD_COND_DEF(HAVE_SINCOS)
-
-CHECK_CXX_SOURCE_COMPILES("
-    #define _GNU_SOURCE
-    #include <math.h>
-    int main(){float x, sin, cos; sincosf(x, &sin, &cos); return 0;}
-    " HAVE_SINCOSF
-)
-GR_ADD_COND_DEF(HAVE_SINCOSF)
-
-CHECK_CXX_SOURCE_COMPILES("
-    #include <math.h>
-    int main(){sinf(0); return 0;}
-    " HAVE_SINF
-)
-GR_ADD_COND_DEF(HAVE_SINF)
-
-CHECK_CXX_SOURCE_COMPILES("
-    #include <math.h>
-    int main(){cosf(0); return 0;}
-    " HAVE_COSF
-)
-GR_ADD_COND_DEF(HAVE_COSF)
-- 
2.25.1

